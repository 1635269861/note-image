# 操作系统

## 进程的调度算法

- 先来先服务调度算法
- 短作业优先调度算法
- 时间片轮转调度算法
- 高响应比优先算法
  
  > 先来先服务算法和短作业优先的算法可能会导致长作业占用时间过长或者长作业得不到执行的极端的情况，可以使用高响应比优先的算法来均衡一下长作业和短作业。每次进行调度的时候，先计算响应比优先级，然后把响应比优先级最好的线程进入运行。响应比的运行公式：`优先权=（等待时间+要求服务时间）/要求服务时间`，均衡了各个作业的执行时间。
- 最高优先级算法
  
  > 时间片轮转的算法假设所有的任务优先级都一样，这样就可能导致优先级高的任务得不到先执行，可以给每个任务分配不同的优先级，但是这样可能会导致优先级低的任务得不到执行。
- 多级反馈队列算法
  
  > 该算法是时间片轮转和最高优先级算法的综合发展，多级表示有多个队列，同时优先级越高的时间片越短；反馈表示如果有新的线程加入优先级别高的队列的时候，立刻停止当前的线程去执行优先级别高的队列的任务。任何一个任务过来都是先放入第一优先级的队列，时间片用完之后放入下一即的队列，这样只有高级别队列没有任务时，才会选取低级别的任务进行执行，保证了优先级和执行时间的平衡，避免了优先级别低的队列的任务不会得到执行的情况。
  
  ## PCB（进程控制块）是什么
  
  **PCB是进程存在的唯一标识，意味着一个进程的存在，如果进程消失了，那么进程也会消失。** 进程控制块包含如下信息：
- 进程描述信息
  - 进程标识符：标识各个进程，每个进程都有唯一的标识符
  - 用户标识符：进程所属的用户，用户标识主要为共享和保护服务
- 进程控制和管理信息
  - 进程当前状态：如新建、就绪、运行、阻塞、死亡的状态
  - 进程的优先级：进程抢占CPU的优先级
    — 资源分配清单
  - 有关内存地址或者虚拟空间地址的信息，所打开文件的列表和所使用的IO设备信息
- CPU相关信息
  - CPU各个寄存器的值，当进程被切换的时候，CPU的状态信息都会被保存在PCB中，便于进程恢复，从断点处继续执行
    
    ## CPU上下文切换、进程上下文切换、线程上下文切换
    
    ### CPU上下文切换
    
    CPU寄存器和程序计数器是CPU在执行运行任务之前，所必须依赖的环境，这些环境就叫做CPU上下文。
    CPU上下文切换就是把上一个任务的CPU上下文（寄存器和程序计数器）保存起来，然后加载新任务的上下文到这些寄存器和程序计数器，最后跳转到程序计数器的新位置，执行新的任务。
    
    > 寄存器是高速缓存，用来存储数据
    > 程序计数器中存放了指令执行地址，CPU通过程序计数器获取下一条将要执行的命令
    
    ### 进程上下文切换
    
    **进程是由内核管理和调度的，所以进程上下文的切换只能在内核态，进程上下文的切换不仅包含了虚拟内存、栈、全局变量等用户空间的资源，还包括了内核堆栈、寄存器等内空间的额资源。**
    通常会把交换的信息储存在进程的PCB中，当要运行另一个进程的时候，我们需要从这个进程的PCB中取出上下文，然后恢复到CPU中，使得这个进程可以继续执行。
    
    ### 线程上下文切换
    
    线程上下文的切换分为两种情况：两个线程是否属于同一个进程：
- 当两个线程不属于同一个进程的时候，则切换的过程就跟进程上下文切换是一样的
- 当线程属于同一个线程的时候，因为虚拟内存是共享的，所以只需要切换线程私有的栈和程序计数器即可。
  
  ## 什么是文件描述符
  
  内核利用文件描述符来访问文件。文件描述符是一个非负整数，打开现存或者新建文件的时候会返回一个文件描述符，读写文件也需要文件描述符来指定待读写的文件。他是一个索引值，指向内核为每一个进程所维护的该进程打开文件的记录表。当程序打开或者创建一个新的文件的时候，内核返回一个文件描述符。
  每个PCB（进程控制快）中保存着一份文件描述表，文件描述符就是这个表的索引，每个表项都有一个指向已打开文件的指针。




