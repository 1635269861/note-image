在实际的生产应用中，根据Alibaba的开发手册，在创建线程池的时候，我们不直接调用Executor框架来创建线程池，这是因为在极端情况下的话可能会导致线程池或者阻塞队列OOM。所以我们需要自己手动创建线程池，线程池的参数重要的有七个，但是最重要的线程池的参数实际上是有三个：`corePoolSize`、`maxPoolSize`、`blockQueue`这三个参数。
在设置线程池参数的时候，可以从两方面情况来考虑：考虑系统的吞吐量和考虑应用的类型。

### 1 考虑应用的类型

**CPU密集型**:corePoolSize = CPU核数+1（多出来的一个线程是用来处理缺页中断的处理情况的）
**IO密集型**:corePoolSize = CPU核数 * 2

> 获取CPU核心数量的方法：`Runtime.getRuntime().availableProcessors()`、使用Linux命令：`mpstat -P ALL 2`

### 2 考虑系统的吞吐量

在B-S架构的系统当中我们更应该考虑的是系统的系统量，此时就应该根据系统的吞吐量来设置线程池的参数。需要根据三个值来确定。
`tasks`:每秒需要处理的任务数，也就是我们所说的吞吐量,我们假设为500～1000
`tasks`:每一个任务话费的时间，假设为0.1s
`responsetime`:系统允许容忍的最大的响应时间
对这几个只做一个关键的计算：
`corePoolSize` = 每秒需要多少个线程来处理?
`threadCount` = `tasks/(1/taskcost)=tasks * taskcount`=(500~1000) * 0.1 = 50~100个线程
所以我们的`corePoolSize`设置应该大于一50.
根据8020原则，如果80%的每秒的任务数小于800，那么`corePoolSize`设置为80即可
计算可以得到`queueCapacity`=80/0.1*1=800。意思是队列里的线程可以等待1s，超过了的需要开启新的线程来处理执行。
切记不能队列的长度为`Integer.MAX_VALUE`，这样队列会很大，线程数只会保持在`corePoolSize`大小，当任务陡增的时候，不能新开线程来执行，响应时间会随之陡增。
`maxPoolSize`：最大线程数在生产环境上我们往往设置成和`corePoolSize`一样，这样可以减少在处理过程中创建线程的开销。
`rejecttdExecutionHandler`:根据具体情况来决定，任务不重要可丢弃，比如在追求吞吐量的时候我，可以抛弃一些不重要的任务，如果任务重要的话可以利用缓冲机制来解决。
`keepAliveTime`：一般采用默认值就可以满足

以上都是理想值，实际情况下需要考虑机器的性能，如果在为达到最大线程的情况机器cpu负载已经满了，则需要通过升级硬件和优化代码。
